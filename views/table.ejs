<% 
var uniqueTags = [];
featureFiles.forEach(function(featureFile) {
  featureFile.tags.forEach(function(tag) {
    if (!uniqueTags.includes(tag)) {
      uniqueTags.push(tag);
    }
  });
}); %>
<!DOCTYPE html>
<html>
<head>
  <title>Scenarino Console</title>
  <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.22/css/jquery.dataTables.min.css">
  <link rel="stylesheet" type="text/css" href="/main.css">
  <script src="/main.js"></script>
</head>

<body>
  <div class="header">
    <div>Console</div>
    <div><a href="/settings">Settings</a></div>
    <% if (runCommand) { %>
    <div id="messages"></div>
    <form style="margin: 0 10px;" onsubmit="showLoader()">
      <p>Execute by tag: 
        <input type="text" id="tagsInput" name="tags" placeholder="Enter tags to execute" data-tags='<%- uniqueTags.join(",") %>'>
        <select id="operatorSelect" name="operator">
        <option value="AND">AND</option>
        <option value="OR">OR</option>
      </select>
      <button id="run-test-button" type="submit">Run Tests</button></p>
    </form>
    <% } %>
  </div>
  <div class="content">
    <div class="tag-box">
      <h2>Tags</h2>
      <ul class = "tag-list">
        <% uniqueTags.forEach(function(tag) { %>
          <li>
            <a href="#" class="tag-label" onclick="addTagToInput('<%= tag %>')" >
              <%= tag %>
            </a>
          </li>
        <% }); %>
      </ul>
    </div>
    <table id="table">
      <thead>
        <tr>
          <th>
            Feature
          </th>
          <th>
            Tags
          </th>
          <th>
            Scenarios
          </th>
        </tr>
      </thead>
      <tbody>
        <% featureFiles.forEach(function(featureFile) { %>
          <% if (featureFile && featureFile.path) { %>
          <tr id="<%= featureFile.featureId %>">
            <td>
              <p class="featureTitle" contentEditable="true" onblur="updateFeature('<%= featureFile.featureId %>', 'featureTitle', this.innerText)"><%= featureFile.featureTitle %></p>
              <p class="featureDescription" contentEditable="true" onblur="updateFeature('<%= featureFile.featureId %>', 'featureDescription', this.innerText)"><%= featureFile.featureDescription %></p>
              <p class="scenarioCount"><%= featureFile.scenarioCount %> scenarios contained</p>
              <p class="featureFilePath">Location: <%= featureFile.path %></p>
            </td>
            <td>
              <ul class="tag-list">
                <% featureFile.tags.forEach(function(tag) { %>
                  <li>
                    <a href="#" class="tag-label" onclick="addTagToInput('<%= tag %>')" >
                      <%= tag %>
                    </a>
                  </li>
                <% }); %>
              </ul>
            </td>
            <td>
              <ul>
                <% featureFile.scenarios.forEach(function(scenario) { %>
                  <li>
                    <span class="tags">
                      <% scenario.tags.forEach(function(tag) { %>
                        <a href="#" class="tag-label" onclick="addTagToInput('<%= tag.name %>')" >
                          <%= tag.name %>
                        </a> 
                      <% }); %>             
                    </span>
                    <a href="#" class="scenario-link" data-tags='<%= JSON.stringify(scenario.tags.map(function(tag) { return tag.name; })) %>'
                       title='<%= JSON.stringify(scenario.tags.map(function(tag) { return tag.name; })) %>'>
                      <%- scenario.name %>
                      <% if (scenario.isOutline) { %>
                        <span>(Outline)</span>
                      <% } %>
                    </a> 
                    <p>
                      <% if (scenario.description) { %>
                      <span><%= scenario.description %></span>
                      <% } %>
                    </p>
                  </li>
                <% }); %>
              </ul>
            </td>
          </tr>
          <% } %>
        <% }); %>
      </tbody>
    </table>
  </div>
</body>
</html>