<% 
var uniqueTags = [];
featureFiles.forEach(function(file) {
  file.tags.forEach(function(tag) {
    if (!uniqueTags.includes(tag)) {
      uniqueTags.push(tag);
    }
  });
}); %>
<!DOCTYPE html>
<html>
<head>
  <title>Scenarino Console</title>
  <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.22/css/jquery.dataTables.min.css">
  <link rel="stylesheet" type="text/css" href="/main.css">
  <script src="/main.js"></script>
</head>

<body>
  <div class="header">
    <div>Console</div>
    <div><a href="/settings">Settings</a></div>
    <% if (runCommand) { %>
    <div id="messages"></div>
    <form style="margin: 0 10px;" onsubmit="showLoader()">
      <p>Execute by tag: 
        <input type="text" id="tagsInput" name="tags" placeholder="Enter tags to execute" data-tags='<%- uniqueTags.join(",") %>'>
        <select id="operatorSelect" name="operator">
        <option value="AND">AND</option>
        <option value="OR">OR</option>
      </select>
      <button id="run-test-button" type="submit">Run Tests</button></p>
    </form>
    <% } %>
  </div>
  <div class="content">
    <div class="tag-box">
      <h2>Tags</h2>
      <ul class = "tag-list">
        <% uniqueTags.forEach(function(tag) { %>
          <li>
            <a href="#" class="tag-label" onclick="addTagToInput('<%= tag %>')" >
              <%= tag %>
            </a>
          </li>
        <% }); %>
      </ul>
    </div>
    <table id="table">
      <thead>
        <tr>
          <th>
            Feature
          </th>
          <th>
            Tags
          </th>
          <th>
            Scenarios
          </th>
        </tr>
      </thead>
      <tbody>
      <% featureFiles.forEach(function(file) { %>
        <tr>
          <td>
            <p class = "featureTitle"><%= file.featureTitle %></p>
            <p class = "featureDescription"><%= file.featureDescription %></p>
            <p class = "scenarioCount"><%= file.scenarioCount %> scenarios contained</p>
            <p class = "featureFilePath">Location: <%= file.path %></p>
          </td>
          <td>
            <ul class = "tag-list">
              <% file.tags.forEach(function(tag) { %>
                <li>
                  <a href="#" class="tag-label" onclick="addTagToInput('<%= tag %>')" >
                    <%= tag %>
                  </a>
                </li>
              <% }); %>
            </ul>
          </td>
          <td>
            <ul>
              <% file.scenarios.forEach(function(scenario) { %>
                <li>
                  <a href="#" class="scenario-link" data-tags='<%= JSON.stringify(scenario.tags.map(function(tag) { return tag.name; })) %>'
                     title='<%= JSON.stringify(scenario.tags.map(function(tag) { return tag.name; })) %>'>
                    <%- scenario.name %>
                    <% if (scenario.isOutline) { %>
                      <span>(Outline)</span>
                    <% } %>
                  </a> 
                  <p>
                    <% if (scenario.description) { %>
                    <span><%= scenario.description %></span>
                    <% } %>
                  </p>
                  <span class="tags">
                    <% scenario.tags.forEach(function(tag) { %>
                      <a href="#" class="tag-label" onclick="addTagToInput('<%= tag.name %>')" >
                        <%= tag.name %>
                      </a> 
                    <% }); %>             
                  </span>
                </li>
              <% }); %>
            </ul>
          </td>
        </tr>
      <% }); %>
      </tbody>
    </table>
  </div>
</body>
</html>